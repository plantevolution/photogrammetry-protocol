[["index.html", "Flower photogrammetry and 3D modeling protocol 1 About 1.1 Citation 1.2 Contributing 1.3 Disclaimer", " Flower photogrammetry and 3D modeling protocol Marion Leménager Jérôme Burkiewicz Loudmila Jelinscaia Lagou Daniel Schoen Diana Constanza Diaz Cardona Simon Joly 2024-02-01 1 About This protocol is an evolving protocol used in the Joly lab at the Université de Montréal (Canada) This protocol describes how to obtain three-dimensional (3D) reconstructions of flowers using photogrammetry. It describes in details the set-up, settings and steps that has worked for us for building accurate flower models, but other approaches are certainly possible. Hence, we hope this protocol serves as a starting point rather than a final protocol. We welcome any comments. 1.1 Citation Leménager, M., J. Burkiewicz, D. J. Schoen, S. Joly. Studying flowers in 3D using photogrammetry. New Phytologist. 237(5): 1922-1933. 1.2 Contributing This protocol was produced with bookdown and is hosted on github. Please do not hesitate to fork the protocol, modify it and make pull requests to improve it! 1.3 Disclaimer We provide this protocol as guidelines, without any guaranty. It has worked well for us for many types of flowers, but there is no guaranty that it will work on all flowers. "],["materials.html", "2 Materials 2.1 Lighting 2.2 Turntable 2.3 Camera 2.4 Color chart 2.5 Softwares 2.6 Flowers 2.7 Summary of materials and software", " 2 Materials 2.1 Lighting It is important to have good lighting conditions to take the photographs. To optimize the lighting conditions, we use a Neewer portable lighting box to recreate lighting studio conditions and reduce shading on the object to a maximum. This lightbox needs to be powered from an outlet or from an external battery. The color of the background used should contrast with the color of the flowers to be photographed. 2.2 Turntable We use an automated turntable and shutter release device (Syrp Genie mini II and turntable) to rotate each flower around itself (360°) and trigger a predetermined number of pictures from the camera to get pictures from all around the flower. The Genie Mini II has several hours of autonomy depending on its use, but it can be plugged in a source of energy during the process (external battery, plug, or usb). This device is easily controlled and set remotely via its application \"Syrp\" (Figure 2.1) on any kind of smartphone (although not all Android versions) with Bluetooth (Appstore or Playstore) after the device has been paired with your phone and after any updates suggested by the device has been done. We also use a 1 cm scale placed adjacently to the flower, and include a label describing the species name, collection number, date of collection, location, and coordinates. Figure 2.1: Syrp application 2.3 Camera It is important to have very sharp pictures for optimal model reconstruction. Ideally, the whole flower should be in focus to maximize the amount of details captured. This could be achieved with focus bracketing (i.e., shooting a series of pictures of the flower at different focus distances) and subsequently, focus stacking (i.e., combining the series of pictures to produce a sharp image with a greater depth of field than any single image; Figure 2.2). Focus bracketing can be easily achieved with a camera that provides this option (we use Canon EOS 90D with a fixed macro lens EF 100mm f/2.8L MACRO IS USM), while focus stacking can be done using software like Helicon Focus (paid) or Enfuse (free in Linux). Figure 2.2: A simplified visual summary of the focus stacking process. (1) Focus bracketing: The camera shoots a series of pictures at different focus distances. (2) Focus Stacking: The series of pictures is combined using specialised software. (3) Final Image: The final image is sharp, with a greater depth of field than any single image taken during focus bracketing. The black arrows show the parts of the flower in focus. However, using a professional camera and doing focus bracketing and stacking are not necessary. We also obtained good results with a Canon T2i/550D camera that shoots 18.0 MP RAW photos (5184 x 3456 pixels) and a fixed macro lens (60mm f/2.8 Macro lens). In general, avoid using a lens that isn’t fixed; zooming in and out can create artifacts during the model reconstruction. Ideally the flower should take a large portion of the photographs for best results. Depending on the weight of the camera, a flexible or a rigid tripod could be used. If a short flexible table-top tripod can safely support your camera and prevent its movement during the shooting, we recommend it for easier and quicker modification of the camera angle at which we take each series of photos. Otherwise, opt for a rigid collapsible tripod, as it is crucial to avoid camera movement, especially during focus bracketing. 2.4 Color chart To calibrate the photos for color, we use a Xrite ColorChecker Passport Photo 2. The main target that we use is the classic target with a 24-patch color reference target to create Digital Negative (DNG) (Adobe Systems Incorporated (2012)) camera profiles from a raw photo (called DNG conversion), and the 75% neutral gray patch to calibrate for light exposure. Figure 2.3: Xrite color chart details for standard Red Green and Blue (sRGB) values. The 75% neutral gray has values of 0.33 (85/255) for Red Green Blue channels in the LightRoom software 2.5 Softwares To convert RAW photos (CR2 or CR3 for Canon Raw Version 2 or 3 image files, respectively) to DNG files, we either use directly Adobe Lightroom Classic to export in DNG format the CR2 photos or Adobe DNG converter. To calibrate the photos according to the color chart, we use the Xrite Color Checker software to create DCP camera profiles from DNG files, and Adobe Lightroom to use these profiles and apply them on an entire set of photos that need the same calibration. To do focus stacking, we first cluster the series of images to be combined based on time intervals using ExifTool and then we use Helicon Focus to stack them. Both can be easily done from the command line using the python scripts provided by the Eaton Lab. To reconstruct the 3D models from photos, we use Agisoft Metashape. 2.6 Flowers Collect fresh flowers from the plant, label them and store them in a cool place or with the tip of the pedicel in some water to prevent accelerated wilting. Different flowers will wilt at different paces. Flowers are pinned through the floral receptacle or pedicel using entomological pins in dense foam at the center of the turntable. Alternatively, flowers can be secured in a truncated pipette tip, itself fixed on the turntable, or with alligator clips to rapidly fix the flowers. Store flowers in 50mL Eppendorf tubes or in foam box no more than an hour before taking photos of them. In some cases, it is necessary to remove sepals from the flower before building the model to accurately study the corolla shape. To do this, use a razor blade and mark the sepal intersections with a waterproof pen. The marks will help for the model construction and more importantly landmarks positioning. 2.7 Summary of materials and software Materials Description Price (USD) Photography Camera Digital Single-Lens Reflex (DSLR) (e.g., Canon t2i or Canon EOS 90D for taking images without or with focus bracketing, respectively) from  $500 Macro lens A preferably fixed focal-length lens (e.g., Canon 60mm f/2.8 Macro lens for the Canon t2i camera, or Canon EF 100mm f/2.8L MACRO IS USM for the Canon EOS 90D camera) from  $400 Tripod Preferably flexible (e.g. Gorillapod), or collapsible from  $30 Stepping motor and turntable kit Syrp Genie mini II and turntable, used to shoot smooth rotating video and interactive 360° images of objects. Full iOS and Android App control via Bluetooth. Battery life: 6hrs video and 15hrs time-lapse. Panning payload 8.8lbs/4kgs $328 Lightbox A portable photo studio, e.g. Neewer Lightbox 20”/50cm foldable portable photography lighting kit (Neewer Technology Co. LTD, Shenzhen, China), adjustable brightness with 120 LED lights, CRI (colour Rendering Index) of 85+, 6000-6500K colour temperature, needs to be powered by a portable battery in the field and comes with white, grey, black and orange backdrops. In the bracket of light intensities possible for this lightbox, we used an intermediate light intensity. [maximum;usually used; minimum] lux light intensities correspond to [3140;2680;1330] lux for a white backdrop and [330;305;238] lux with a black backdrop. e.g. $89 External battery Powering source for in-field photo capture, essentially for the lightbox or to recharge batteries optional Flower mounting and identification Flower Freshly cut flower with pedicel and floral receptacle / Labels and container Identification and storage of fresh flowers to avoid damage and avoid wilting / Turntable labels To provide information on species, collector, collection number, date, locality, and coordinates, and the chunk number. To use as a separate photo before each run of photos. / Razor blade To remove flower parts (e.g., sepals) / Small block of dense foam attached to the center of a paper disk To fix flowers in place with a pin at the center of the turntable. The foam and the paper disk should have the same color as the backdrop used. / Entomological pins To pin through the peduncle or floral receptacle and fix the flower on the turntable. / Scale A 1 cm scale to use as reference / Colour calibration Color chart A color reference to calibrate RAW photos (e.g. X-rite ColorChecker Passport) e.g.  $90 Color calibration software ColorChecker Camera Calibration, Xrite software for automatic color profile creation Free Photo editing software Adobe Photoshop Lightroom, editing software for image color calibration in batch Payment plans vary DNG conversion software Adobe DNG converter, to convert Camera Raw files from supported cameras to the more widely used DNG raw files Free Focus stacking (optional) Image clustering software ExifTool, to cluster the images taken with focus bracketing from each angle based on time intervals Free Focus stacking software Helicon Focus Pro (Mac OS X, Windows) or Enfuse (Linux), to focus stack the clustered images and produce a sharp image with a high depth of field Payment plans vary Python scripts Python scripts developed by the Eaton Lab to use ExifTool and Helicon Focus through the command line for faster processing Free Model reconstruction 3D reconstruction from photogrammetry software Agisoft Metashape Pro Software $549 Academic price References "],["settings-and-preparation.html", "3 Settings and preparation 3.1 Camera and tripod settings and preparation 3.2 Turntable settings and preparation 3.3 Summary of settings", " 3 Settings and preparation 3.1 Camera and tripod settings and preparation To obtain the best picture quality for model reconstruction, we need an optimal combination of the light sensibility of the sensor (ISO), the duration of exposure and the focal of the objective (F). As mentioned, it is preferable to use a fixed lens (one that doesn’t allow zooming) to facilitate the model reconstruction in the processing step because the software can’t take zooming into account in the reconstruction process. Maximizing the light source allows us to use the lowest ISO to get crisper images. Adjust the time exposure to allow the right amount of light to go to the sensor, avoiding low key and high key photos (i.e., under/over exposed photos). This may be adjusted according to the subject (light or dark colored subject or background) or if different lighting conditions are used. A flexible tripod (Figure 3.1) can be used to easily and quickly adjust several camera heights (high, middle, and low) close to the subject. If this option cannot safely support your camera and prevent its movement during the shooting, opt for a rigid collapsible tripod, as it is crucial to avoid camera movement, especially during focus bracketing (Figure 3.2). Figure 3.1: Flexible tripod. Figure 3.2: Collapsible tripod. 3.1.1 Camera settings The standard settings have to be adjusted depending on the flower (mostly colour and conditions). 3.1.1.1 Without focus stacking If not doing focus stacking, we often use the following settings: M (Manual Exposure) mode dial, 1/20s exposure time (shutter speed), F/16 aperture, ISO 100, and standard exposure on the light meter. Using the “Manual Exposure” on the camera dial and setting the focal F to F16 will maximize the depth of field without lowering the image quality. Use the manual focus setting on the side of the lens (Figure 3.3) to avoid camera trigger malfunction when the flower doesn’t land on the detector. If the focus setting is set to automatic and the flower is off centered during rotation, the camera might not be able to focus (on the background) and thus, prevent the camera trigger. On manual, the camera will always be triggered by the turntable, even if the focus isn’t optimal. Because the subject is moving and may be off centered on the turntable, the focus may need to be adjusted while the turntable runs. For this you can pause the turntable, manually adjust the focus, and resume the spin. In general, we save pictures as RAW files (ML setting on the camera display) to be able to post-process them for color calibration (Figure 3.4). A RAW photo of the color chart with an identical set of lighting conditions and camera settings as the flower to be photographed is needed for each flower photos series. If several flowers are processed one after the other without variation of light conditions, only one chart photo is needed. The nicer and the sharper the photographs, the easier it will be to build the models. So make sure that the flower is always in focus. Shade or high light reflectance can also impair model reconstruction, so pay attention to these while taking the pictures. Figure 3.3: Camera (Canon T2i/550D) and lens (60mm f/2.8 Macro lens) used to take RAW photos. The red arrows (from top to bottom) depict the button to get manual focus, the ISO button and the Manual Exposure mode dial. Figure 3.4: Camera settings interface of the Canon t2i/550D (no focus stacking). 3.1.1.2 With focus stacking If you decide to do focus stacking for your project, check the manual of your camera for optimal parameters during focus bracketing as they may slightly differ from what we use. For a Canon EOS 90D camera, we use the following settings: M (Manual Exposure) mode dial, 1/20 exposure time, F/11 aperture, ISO 100, Auto Focus (AF) lens focus mode, RAW image format (Figure 3.5, Figure 3.6).We usually use the Zone AF method and enable Continuous AF (On the camera screen, Shooting Menu, Tab 6). Turn off the Image Review option (On the camera screen, Shooting Menu, Tab 1) to prevent delays after taking each set of pictures. To enable focus bracketing on EOS 90D, press the “START-STOP” button to enter the Live View Shooting Mode, then enable Focus Bracketing (On the camera screen, Shooting Menu, Tab 5). If using an EF 100mm f/2.8L MACRO IS USM lens, disable Exposure Smoothing (option within Focus Bracketing), otherwise it may cause changes in image brightness. The optimal number of shots and focus increments depend on the size of the flower, as well as its position and distance from the camera (Figure 3.7). For example, from the highest camera position, 8 images with a focus increment of 4 works good for a ~2.5x1x1cm (LxWxH) tubular flower, but from an en-face camera angle (i.e. the flower opening facing the camera), 10-12 images with a focus increment of 3 may work better. Test what parameters would produce the smallest number of shots with each part of your flower in focus in each case. Generally, the higher the number of shots, the smaller the focus increments can be. If the camera fails to capture all parts of the flower in focus, the turntable can be paused to make the appropriate adjustments. This may be the number of shots and focus increments, and/or the starting focal point, which should ideally be on the flower part nearest to the lens. Following the adjustment, the spin may be resumed to continue with image capturing. To save time, optimize the number of shots and focus increments from the start to avoid adjustments during image capturing, and help the camera focus by tapping on the part of the flower nearest to the lens after each rotation, before the camera is triggered. This part will be in focus in the first image taken at each rotation point, while the focus will gradually shift to points further from the lens with each subsequent image. Figure 3.5: Camera (Canon EOS 90D) and lens (EF 100m f/2.8L MACRO IS USM) used to take RAW photos for focus stacking. Arrow on the lens: Focus mode button set to Auto Focus (AF). Arrows on the camera body (from top to bottom): ISO button, Manual Exposure mode dial and “START-STOP” button (for Live View Shooting Mode). Figure 3.6: Camera settings interface of the Canon EOS 90D, used for projects with focus stacking. Figure 3.7: Focus bracketing settings of the Canon EOS 90D. 3.1.2 Optional: custom camera white balance Optionally, you can begin by setting a personalized white balance (WB) in your camera with the light gray scale on the chart: For a Canon camera, take a picture of the gray scale; Choose Custom WB in your camera settings (Figure 3.8); Select Custom and use the picture of the grey scale to define your custome white balance (Figure 3.9). Be careful, you will still require to linearize and calibrate each photo afterwards. However, the color chart will always be the reference for post-processing the color calibration of each photo. This optional section only helps to have a better preview of the photos. Figure 3.8: Custom whhite balance parameter. Figure 3.9: How to select a custom white balance. 3.2 Turntable settings and preparation If not doing focus stacking, for each run (one 360° spin of the turntable), we use a wait time of 2s to allow the camera time to save the images on the SD card after it is triggered, and the flower to stabilize after each rotation. If doing focus stacking, we use a wait time of 6-8s depending on the number of shots and focus increments. Connect the shutter release to your camera and the turntable Syrp Genie II (Figure 3.10). Turn the turntable on (to turn it off, hold the on button for 3 seconds). Connect the Syrp Genie II to your device, and do the updates if required (needs an internet connection). Click on Create Content &gt; Turntable (Figures 3.11, 3.12). Make sure the turntable orientation is inverted in the detailed settings (Figure 3.13) In parameters (Figure 3.14), select 20 photos for each run, and the appropriate amount of waiting time depending on if you are doing focus stacking (6-8s) or not (2s; move-wait-shoot-wait-move). If it is too quick, some pictures won’t be able to be saved as the camera needs a delay to save them on the memory card. The spinning device will take the first picture then proceed to a move-shoot-move run until the last photo. Place the white background paper disk with the foam block on the turntable to contrast with the flower. If your flower is pale, then use a different background (colored or darker). Ideally, the color of the disk and the foam block should be the exact same as the color of the backdrop in the lightbox as this will help when applying masks later. Figure 3.10: Camera shutter release port. Figure 3.11: Camera shutter release port. Figure 3.12: Camera shutter release port. Figure 3.13: Genie detailed settings. Figure 3.14: Start recording with the turntable. 3.3 Summary of settings Parameter Value Camera settings Aperture F/16 (no focus stacking) or F11 (focus stacking) Sensibility ISO 100 (lowest) Exposure time 1/20s (depending on light settings) Turntable settings Number of photos 20 per camera height (high, mid, low) Wait time 2s (no focus stacking) or 6-8s (focus stacking) "],["image-capture-step-by-step.html", "4 Image capture step-by-step 4.1 Take a picture of the color chart 4.2 Flower placement &amp; image capture", " 4 Image capture step-by-step 4.1 Take a picture of the color chart Camera settings: Without focus stacking: Set the camera settings to F/16, ISO 100, 1/20s, and RAW format. With focus stacking: Set the camera settings to F/11 (depends on the ideal settings of your camera and lens for focus bracketing), ISO 100, 1/20s, and RAW format. Verify that you have enough space on your SD card for RAW photos: Without focus stacking: A minimum of 163 photos, accounting for photos of labels and chart. With focus stacking: The total number of photos depends on the number of shots at each rotation point and the number of flower positions used (usually around 1,500 photos +-200). Verify that the placement of your turntable inside the lightbox will allow to capture correctly the flower you are about to photograph (distance from opening of the lightbox) and that the 1/20s shutter speed captures enough light from your flower by taking an initial photo of your flower. If satisfactory go to the next step. The goal here is to have a definite set of settings that will match both your flower photos and a color chart to subsequently calibrate all your photos that have the same light conditions and camera settings. Place the color chart where the flower will be placed, without shadows, and exposed under the same light as the flower will be (angled towards the LED source light in the lightbox). The camera settings and lighting cannot be changed after this. If the lighting or the camera settings are modified, the color chart needs to be taken again to correct the corresponding photos. Place the camera so that the entire chart is visible. Take a picture of the color chart in RAW format (if you are doing focus stacking for your project, disable the focus bracketing function for this step). Make sure to incorporate all color squares and the corners of the chart as shown below (Figure 4.1). Figure 4.1: Colour chart photo taken at the beginning of the process to calibrate the photos in post process. 4.2 Flower placement &amp; image capture To reconstruct an accurate 3D model, it is very important to have pictures of all the parts and details of the flowers and from several angles. Also, the photographs need to overlap with each other for proper alignment in the first steps of the reconstruction. For this reason, several pictures will be taken of each flower, from different perspectives and all around the flower. We suggest that flowers are photographed from at least two positions (e.g., Figure 4.2). For more complex flowers, three positions may be required: horizontal, vertical, and upside down (Figure 4.3). Note that it is better to take more photos than less because if we can drop some pictures during the model reconstruction, it is impossible to come back and take more pictures if we realize that we should have. Figure 4.2: Two flower positions that are normally suficient for Gesneriaceae flowers. Figure 4.3: More complex flowers can require the pictures to be taken from three flower positions. For Gesneriaceae, we first suggest a standard and an upside-down position (Figure 4.2) of the flower as this generally gives satisfactory results. For more complex flowers, three positions may be required: horizontal, vertical, and upside down (Figure 4.3). Clip the camera on the tripod and place it at one of the three position required per flower position: high, mid, and low position (see Figure 4.4. Make sure to not use different camera orientations (landscape vs. portrait). If sepals need to be removed, use a razor blade to cut them at the base and mark the sepal intersections with a waterproof pen to keep track of the morphological structures. Pin the flower through the pedicel or the floral receptacle and through a block of dense foam or malleable gum using an entomological pin. You can use several pins to avoid any sliding of the flower during the image capture process. Make sure to place the flower so that it is wholly encompassed in the camera frame as much as possible. It is best to have the subject take as much space as possible in the camera frame to capture every details overall than having it entirely in the camera frame but with poor detail quality. What counts the most is getting several overlapping photos of each feature. Make sure that the flower is not in contact with anything as this would deform it and create problems during the model reconstruction. For flowers with very uniform color or with radial symmetry, it may be helpful to place dots on the corolla using a waterproof pen to facilitate manual marker positioning and/or automated pixel position detection in the reconstruction step. Place a scale (e.g., 1 cm) directly below the flower. Take a picture of the flower with the label for each new positioning of the flower. This will help to identify each group of images during model reconstruction. If you are doing focus stacking, enable Focus Bracketing function at this point and optimize the number of shots and focus increments so that you get each flower part in focus in at least one image. Tap on the part of the flower that is nearest to the lens before the first picture is taken at each rotation point, if it is not already in focus at that moment. Press the REC button on your smartphone using the turntable interface to start the spin of the turntable and automated image capture. Verify occasionally the focus on the flower while the flower rotates by pressing the square button (stop) and manually adjust the focus if needed, then press REC to resume your spin. You can also help the camera focus by tapping on the flower before the camera is triggered at each rotation point. Figure 4.4: The three camera positions from which pictures should be taken for each flower position. Adjust the number of flower positions and number of photos according to each flower. For intricate flowers, or flowers that can’t be captured entirely with only two positions (ventral and dorsal), you can place the flower on an another position (Figure 4.3). On the contrary, if the flower can’t be placed on several positions, you may need to increase the number of photos per camera height in order to have sufficient information for the software to reconstruct accurate 3D models. "],["image-post-processing.html", "5 Image post processing 5.1 File names and storage 5.2 Image color calibration 5.3 Image clustering (one folder at a time) 5.4 Focus stacking (one folder at a time) 5.5 Alternatively: Cluster and focus stack photos from multiple folders at once", " 5 Image post processing 5.1 File names and storage We found that it is critical to have a very organized structure for saving files, especially when several people are working on the same project. We propose here what has been working so far for us. In a species folder named with the name of the species (Genus_species), there should be a distinct folder for each individual photographed, usually with a different collection number. If the same individual has been photographed several times, the date of photos acquisition should be appended to the folder name to discriminate them. We also indicate in the folder name whether the individual has been photographed with or without sepals. For each flower, we have one folder for uncalibrated photos, one for calibrated photos, and one for the model. The RAW picture of the color chart should be placed in the uncalibrated photos. To distinguish which photo goes in which chunk, a photo of the label is taken at the beginning of each chunk (each set of photos per side of flower). We suggest to place the photos from different chunks in different folders once the photos are calibrated. The date of when the photos are taken is important because it helps matching the calibration to the right DNG file. If more than one set of photos with different lighting or camera settings are taken, make sure to distinguish the color charts that correspond to each set of photos. Genus_species GEN_species_CollectionNumber sepal_DD.MM.YYYY or no_sepals_DD.MM.YYYY Model MetashapeProject MetashapeProjectFolder.files model.obj model.ply texture.jpg 01_Photos_to_calibrate Place here all the RAW photos and color chart 02_Photos_calibrated Place here all the calibrated photos, that you can organize per chunk If you are doing focus stacking, you can also create the following two folders in addition to the above: 03_Photos_clustered Place here the calibrated photos that have been clustered based on time intervals into separate subfolders containing series of pictures taken using the Focus Bracketing function at each rotation point 04_Photos_focus_stacked Place here all the final images after focus stacking 5.2 Image color calibration 5.2.1 Creating color profiles We present here three ways to create camera profiles. The first one allows to manually check the automatic detection of the color chart, the second and third ones are fully automatic (on MacOS and windows respectively). This does not linearize the photos. For further details on color calibration, read Troscianko and Stevens (2015). Method 1 : Manual creation of color profiles This method uses the Xrite ColorChecker Camera Calibration software and Adobe DNG converter software (Figure 5.1). Create a new empty folder called DNG. Copy the RAW file representing your color chart in your DNG folder, and rename it accordingly (e.g. Color_chart_DD.MM.YYYY). Open DNG converter and select the DNG folder you created in the first step. You can’t select a specific file, you need to select a folder, and the software will convert all the files within this folder. Default parameters are fine for step 2-4. It will export the RAW file in the DNG folder to a DNG file with the same file name (Figure 5.2). Open the Color Checker Camera Calibration software and drag and drop the newly created DNG file in the software. The software will automatically draw a grid around it. Make sure that the green grid fits the chart, avoiding edge effects on each square of color (Figure 5.3. Click on Create Profile and save it under Color_Chart_DD.MM.YYYY (Figure 5.4. Figure 5.1: Image color calibration workflow. Figure 5.2: Convert RAW chart to DNG in Adobe DNG Converter. Figure 5.3: Align grid on chart in ColorChecker Camera Calibration. Figure 5.4: Export the color profile. Method 2: X-Rite Color Checker plug-in installation and automatic creation of color profiles on MacOS Directly in Adobe Lightroom, you can add ColorChecker Camera Calibration as a module to a means of exporting files directly into a color profile. Click on File &gt; Export &gt; Plug-in Manager (or gestionnaire des modules externes in the left bottom corner). Click on Add. Navigate to Library &gt; Application Support &gt; Adobe &gt; Lightroom &gt; Modules. Select XRiteColorCheckerPassport.lrplugin and then click on Add Plug-in and Done. Click on the color chart then File &gt; Export &gt; Choose Xrite presets from the drop down menu. Name your profile then &gt; Export. It will go through ColorCheckerCamera calibration to automatically create the profile. Restart Lightroom as indicated. Method 3: X-Rite Color Checker plug-in installation and automatic creation of color profiles on Windows Get the Xrite ColorChecker Camera Calibration software and download the PC Version. Save the CameraCalibrationSetup.exe in your downloads, for example, and run the program. If Adobe Lightroom Classic is already installed on your computer, the installation program should proposed you to install the Adobe Photoshop Lightroom plug-in (Figure 5.5). Install it. Once the plug-in is installed, run Adobe Lightroom Classic and import your color chart (File &gt; Import). Click on File &gt; Export and in the drop-down menu, select X-Rite Preselection (Figure 5.6). Name your profile, and click on Export. Restart Lightroom as indicated. Run the setps 4 and 5 each time you want to create a new color profile witht the color chart. Figure 5.5: Color Checker plug-in for Lightroom installation. Figure 5.6: Color chart profile exportation. 5.2.2 Color and exposure calibration from profiles Import your photos in Lightroom Classic. File &gt; Import then select your folder of RAW photos. Select the photo of the color chart. Go to the Development module. Select the color profile corresponding to the color chart you have selected (see Figure 5.7 and 5.8 to manually add a color profile) to calibrate the photo of the chart with its own calibration profile. Figure 5.7: Add a new color profile. Figure 5.8: After adding a profile with the + sign, select it in the list below. Use the eyedropper over the 75% gray scale (the dark gray patch right before the black patch on the color chart). Do not click on the photo with the eye dropper, only hover over it. Adjust the RGB values the eyedropper indicates on the 75% gray scale by changing the exposure setting to make them as close as possible to 0.33 0.33 0.33 (corresponding to 85/255 for each of the red, blue, and green class). The exposure is now adjusted in addition to the color calibration, but only on the chart image. To apply the modifications we just did to all the photos, go to the Library module, select all the photos (Cmd+A or Ctrl+A), and make sure that the one for which you made changes is highlighted (in white compared to the light gray of the newly selected images). Go back to the Development module and click on the Synchronize option, check the profile and exposure boxes in the pop-up window and click on Synchronize (see Figure 5.9). Figure 5.9: Synchronize your settings made to the photo of the chart to all the other photos and check the two categories you modified (color profile and exposure). 5.2.3 Export calibrated files Select all the photos you need to export or all of them (Cmd+A or Ctrl+A). Click on File &gt; Export. You can create presets that you will only need to create once to always export the same way in Adobe Lightroom (example Figure 5.10), and add personalized file names such as \"_color_calibrated\" at the end of each image file. Without focus stacking: Save the calibrated images as JPEG. With focus stacking: Save the calibrated images as TIFF (300 PPI). Make sure to include all metadata. The calibrated folders can be saved into their own folder, and further divided into different subfolders representing different chunks (easily distinguishable by the separation created by a photo of the label). Figure 5.10: You can export using your own personalized parameters and then export in batch your selection in a specific folder within your folder of uncalibrated photos for easy access. This method can thus work for any folder of uncalibrated photos. 5.3 Image clustering (one folder at a time) Note: This step is only necessary if you chose to do focus stacking in your project. If you used the Focus Bracketing function during image capture and wish to proceed with focus stacking, you can make the process easier by first grouping (i.e., clustering) the series of photos taken at each angle and rotation point in separate subfolders. This way, each folder will contain images that can be stacked together as they depict the same flower angle and rotation point but with different focus distances. This can be achieved using ExifTool. ExifTool extracts time-stamps from the metadata of images and can be used to separate the image clusters from each other based on time intervals. The time intervals between photos taken at each rotation point (i.e., at the same exact perspective, but with different focus distances) is smaller than between photos taken between two rotation points (i.e., after the turntable changes the flower angle) when using the Focus Bracketing function. To make image clustering faster, a python script developed by the Eaton Lab can be used (cluster_photos_by_time_intervals.py). Command structure: python3 cluster_photos_by_time_intervals.py -i &lt;input folder with calibrated images&gt; -o &lt;output folder with clustered images&gt; Example: python3 cluster_photos_by_time_intervals.py -i 02_Photos_calibrated -o 03_Photos_clustered After running the command above, you will have a 03_Photos_clustered folder containing subfolders with the different image clusters, distinguished by angle and rotation numbers based on their time-stamps. 5.4 Focus stacking (one folder at a time) Note: This step is only necessary if you chose to do focus stacking in your project. With the image groups taken at each rotation point and angle separated into different folders, they can now be easily focus stacked to produce one image per cluster with the whole flower in focus. Similarly to image clustering, this can be achieved by running another python script developed by the Eaton Lab (helicon_focus.py). Command structure: python3 helicon_focus.py -i &lt;input folder with clustered images&gt; -o &lt;output folder with focus stacked images&gt; Example: python3 cluster_photos_by_time_intervals.py -i 03_Photos_clustered -o 04_Photos_focus_stacked Now you should have a 04_Photos_focus_stacked folder containing one focus stacked image corresponding to each angle and rotation point cluster. 5.5 Alternatively: Cluster and focus stack photos from multiple folders at once In case you would like to cluster and focus stack images of multiple specimens at once, to make the process even faster, you could also use the Automated Pipeline Scripts developed by the Eaton Lab. You can use these scripts for all steps (i.e., from image calibration to focus stacking) or modify them according to your preferences and needs. We normally do the calibration step manually in Adobe Lightroom Classic as it does not take significantly more time and allows for calibrating both the colors and exposure of the images. To make the scripts work, we save the calibrated images in a subfolder directly in the corresponding RAW image folder, for example in 3D_Modelization/Genus_species_A/01_Photos_calibrated/, with the RAW images being in 3D_Modelization/Genus_species_A/, while the directory containing the 3D_Modelization/ contains other folders that are similarly structured for other species. 3D_Modelization Genus_species_A RAW_photo_A1.CR3 RAW_photo_A2.CR3 RAW_photo_A3.CR3 … 01_Photos_calibrated Calibrated_photo_A1.tif Calibrated_photo_A.tif2 Calibrated_photo_A3.tif … Genus_species_B RAW_photo_B1.CR3 RAW_photo_B2.CR3 RAW_photo_B3.CR3 … 01_Photos_calibrated Calibrated_photo_B1.tif Calibrated_photo_B2.tif Calibrated_photo_B3,tif … … For the sake of simplifying the following examples,3d_Modelization/ would represent the path to your working directory that contains all your folders. First, you need to create a text file containing a list of folder names in your working directory, i.e., the folders names in the directory 3D_Modelization/ following the example above. cd to this directory and run the following command: ls -b1A &gt;&gt; folder_name.txt This command will create a folder_name.txt file in your working directory with the names of all the folders in it. Then you need to create a text file containing the list of the RAW photo names within these folders. Command structure: for i in `cat folder_name.txt`; do cd 3D_Modelization/${i} &amp;&amp; ls *.CR3 | sed -e &#39;s!.CR3!!&#39; &gt;&gt; photo_names.txt; done Now, aside from the RAW photos and the subfolder with the calibrated .tif photos, the Genus_species_#/ folders within the 3D_Modelization/ directory should contain a photo_names.txt file with a list of the names of all the RAW photos in each folder. We usually run the following modified automated script for processing multiple folders at once. Automated script structure for clustering and focus stacking photos from multiple folders at once: for i in `cat 3D_Modelization/folder_name.txt` do python3 cluster_photos_by_time_intervals.py -i 3D_Modelization/${i}/01_Photos_calibrated -o 3D_Modelization/${i}/02_Photos_clustered &amp;&amp; python3 helicon_focus.py -i 3D_Modelization/${i}/02_Photos_clustered -o 3D_Modelization/${i}/03_Photos_focus_stacked done The for loop above should create two new subfolders in each of your 3D_Modelization/Genus_species_#/ directories: 02_Photos_clustered, containing the calibrated photos that have been clustered by angle and rotation points based on time intervals. 03_Photos_focus_stacked, containing the final focus stacked photos. Although the original automated pipeline script by the Eaton Lab includes a step for resizing the photos after focus stacking, we do not typically include this step in the process as the photos’ dimensions before and after focus stacking remains the same most of the time. Additionally, changing the images’ dimensions to a different ratio can distort the shape of your 3D Model. For those few images whose dimensions do change after focus stacking (for us it’s normally no more that 3 per specimen), during the masking step in Agisoft Metashape it will notify you that the background image you are using does not have the same size as some of the images. You can find those unmasked photos and create a background images using their dimensions for masking them. However, as mentioned, this happens rarely. If you wish to resize all your images after focus stacking following the original script, you will need to install imagemagick, which could be done using homebrew. brew install imagemagick Automated script structure for clustering, focus stacking, and resizing photos from multiple folders at once: for i in `cat 3D_Modelization/folder_name.txt` do python3 cluster_photos_by_time_intervals.py -i 3D_Modelization/${i}/01_Photos_calibrated -o 3D_Modelization/${i}/02_Photos_clustered &amp;&amp; python3 helicon_focus.py -i 3D_Modelization/${i}/02_Photos_clustered -o 3D_Modelization/${i}/03_Photos_focus_stacked &amp;&amp; cd 3D_Modelization/${i}/03_Photos_focus_stacked &amp;&amp; ls -b1A | sed -e &#39;s!.tiff!!&#39; &gt;&gt; stacking_names.txt &amp;&amp; for i in `cat stacking_names.txt` do convert ./${i}.tiff -resize 5300x3500! ./${i}.tiff done done Remember to add the path to your python script files if they are not located in your working directory, as well as modify the final image size if you wish it to be different. References "],["d-model-reconstruction-in-agisoft-metashape.html", "6 3D model reconstruction in Agisoft Metashape 6.1 Download Agisoft Metashape 6.2 Initial tweaks 6.3 Overview of the model building pipeline 6.4 Photo importation 6.5 Mask application 6.6 Masks touch ups 6.7 Image alignment 6.8 Align chunks together 6.9 Merge chunks 6.10 Build 3D mesh 6.11 3D mesh touch ups 6.12 Build texture 6.13 Scaling 6.14 Model orientation 6.15 Export model and texture", " 6 3D model reconstruction in Agisoft Metashape 6.1 Download Agisoft Metashape Download the Agisoft Metashape professional edition software here. Make sure that your computer fills the minimum system requirements. The standard edition doesn’t allow the use of the scale option, which we will need to add a scale to our models. Figure 6.1: Agisoft Metashape Logo. 6.2 Initial tweaks Agisoft Metashape can use graphic cards at certain steps of the model construction such as image matching and depth maps calculation. To enable the use of the graphic hardware (GPU): Select Preferences command from the Tools menu (v. &lt;2.0) or MetashapePro menu (v. &gt;2.0). In Preferences dialog select GPU tab. Select available GPU devices in GPU tab of the Preferences window. This step has to be done only once. This protocol has been elaborated using the version 1.7.1 of Agisoft Metashape. The latest version of Metashape is now version 2.0.3, but we still made the following changes. In order to obtain accurate thin structures, such as petal margin, and avoid holes in your mesh in Agisoft Metashape versions older than 2.0 (as far as we know) you will need to activate ONCE the Visibility consistent mesh function in Tools &gt; Preferences &gt; Advanced &gt;Tweaks, then Add and fill in Parameters with BuildModel/tvl1_mesh and select the value as False (figure 6.2). Additionally, to use the anterior version of the depth maps generation process, add ONCE the tweak: BuildDepthMaps/pm_enable and set the value to False (figure 6.3). For Agisoft Metashape 2.0.x (as far as we know) the Preferences are located in the MetashapePro menu. Figure 6.2: Tweaks settings (A). Figure 6.3: Tweaks settings (B). 6.3 Overview of the model building pipeline To build a model, we need to do the following steps: (1) Import the calibrated photos, (2) Apply masks to remove the background of the photos, (3) Align the photos, (4) Calculate depth maps, (5) Build the 3D model (mesh), and (6) Reconstruct the final texture (model color). There could be different approaches for each of the steps and options will be given below. One important thing to consider is whether to align all the photos simultaneously or proceed by groups of photos (i.e., “chunks”) that correspond to each flower position. The first approach is quicker and normally results in more accurate models. However, it does not work all the time. We recommend to try the first approach and if it fails, to use the alternative approach, which is to divide the pictures in different \"chunks\" that will create partial 3D models that will be subsequently merged. 6.4 Photo importation Go to Workflow, click on Add Photos, and click Open. Once the photos are imported, they are in a single \"chunk\". To try to align all the photos simultaneously (ideal approach), you need to arrange them in “Image Groups” ot “Camera Groups” (e.g., select the photos, right click, Move Images/Cameras &gt; New Image/Camera Group)*, where each camera group contains all pictures taken with the same flower orientation and camera angle. Once this is done, you can add the first photo of each set of photos representing the label, right click on this photo and select Disable Cameras or Disable Images*. This allows you to not take it into account while reconstructing the model, but to keep all the information about the flower in your Metashape project. *Note: Depending on the version of Agisoft Metashape, some functions use either the word “camera(s)” (v.&lt;2.0) or “image(s)” (v.&gt;2.0) as far as we know. 6.5 Mask application Masks represent selected areas that are excluded from the feature detection procedure when applied to key points detection. When several keypoints are detected as the same point (matched as projections of the same 3D point on different photos), then it is considered as a tie point. If masks are applied to tie points, then if a key point is masked in at least one image, it will not be considered. You can thus use a single or just a few masks with the second method and apply masks to tie points. It is however possible to automatically apply masks on each photo to better constrain key point detection and then apply masks to keypoints. Using masks helps in removing points from being detected in the background during the image alignment procedure. You can see examples here on the Agisoft helpdesk portal. Step-by-step mask application workflow Duplicate one of your photos, and fill it in black (or the main color of your background) in any image manipulation software, and rename it to background.jpg or background.tif depending on the format of your photos. You can also take a picture of the lightbox without your flower just before starting to shoot and use this image as background. This sometimes work better. Right click on a photo in one of your chunk in your Metashape project. Click on Masks, Import Masks (Figure 6.4) and in the box that appears select the method From Background and operation Replacement. Enter the same name as the name of the background image you created in step 1. Depending on the flower and how contrasting its color is relatively to the background, the value for Tolerance can vary between approximately 40 and 60 (Figure 6.5). For some pale flowers you may need a lower tolerance value (e.g. 30 or lower). Test different values of tolerance on a single photo first and when you have a value that is satisfactory (i.e., that creates a mask with the border of the flower well defined), you can select Apply to &gt; Entire workspace. Click OK. This will automatically produce masks around the flowers for all the photos in all your chunks. This is why we need a contrasting background color behind the flower. Check for masks that need touch ups (see next section). Figure 6.4: Right click on an image to select a mask to import. Figure 6.5: Import mask from a black image background.jpg, and select a tolerance value, to test on the selected camera (the image you right-clicked on). If the automatic mask is automatically well adjusted around the flower shape (darker gray around the flower), then apply to entire workspace (all the images). Alternative masking method using Adobe Photoshop. It is also possible to use Adobe Photoshop to apply masks. We did not find particular improvements compared to the Agisoft Metashape approach. Go to the file containing the pictures of chunk 1. Copy and paste this file, naming it accordingly (e.g. Chunk1-Background). Go to Adobe Photoshop version 19.1 and up. Make a copy of all of the photos you’ll be using and place them in a new folder labeled Chunk1-masks. Then, you will need to create ONCE a Photoshop action, that will be subsequently reused (see Figures 6.6 to 6.9 below) : Figure 6.6: Record a new action called Automatic Mask - 3D reconstruction. Figure 6.7: When you reopen your photo, don’t forget to remove this extra task in your action. Figure 6.8: The action should include Select Subject, Fill, Inverse, Fill, Save, Close, and you can batch process this action to a specific folder of copied photos to create masks. Figure 6.9: Apply the action to the folder of copied photos called Chunk1-masks. Now you should have tranformed all your copied photos into masks, with the foreground object in white, and the background in black. Go to Agisoft Metashape and right click on the first camera (photo) of chunk 1. Click on Masks &gt; Import Masks and in the box that appears select method From file, operation Replacement. In Filename Template use filename.jpg. Select Apply to all cameras and then click OK. Check the masks for touch ups. 6.6 Masks touch ups The automatic application of masks at the previous steps is sometimes not entirely satisfactory for all photos. To add parts to the mask (i.e., remove them from the model) such as the foam block and the entomological pin, it is possible to select them using the selection tools and then add them using the respective Add Selection button (Figure 6.10). Similarly, you can remove or invert the selection with the buttons to the right of the Add Selection button. Figure 6.10: Selection tools and add selection to mask tool. 6.7 Image alignment Click on the chunk you want to align, which could comprise several image/camera groups. Make sure to disable photos you don’t want (e.g., the label photo, and blurry photos) and that the masks are clean. Go to Workflow &gt; Align Photos and put the accuracy on High or Very high (do not select the latter if you did focus stacking). To save some time, you can check Generic preselection in the section Advanced. Select Apply masks to Key points and click OK. Note that if you have applied the masks to only some photos, select Apply masks to tie points. If you are aligning several chunks of photos, it is possible to run this job in batch for each chunk in Workflow &gt; Batch Process &gt; Add and select the Job type as Align Photos to apply to All Chunks or select specific ones (Figure 6.11). Figure 6.11: Align photos in multiple chunks. Optional: Align using markers. If the images cannot align properly, it is possible to place homologous markers on the flower, defined as remarkable points (e.g., distinguishable pattern such as color dots on the corolla), or little pen marks at the surface of the flower when homologous markers lack. These points need to be clearly identifiable on all chunks. You will need at least 5 markers, ideally located at different areas of the flower (e.g., near the pedicel, sepal tips, petals). Do not use points from the background to align chunks as they are independent from the flower (the flower changes position relative to the background). With the Navigation button selected (i.e., the “cursor” tool at the top), right click on the point you want to add a marker on. Click on Place Marker &gt; New Marker. In the left panel, rename the marker accordingly. Make sure to use the same nomenclature on each chunk to be able to merge them according to their names. To help the software recognize the markers, spread them on photos throughout the chunk (it is normally sufficient to manually place them on 2-3 photos and the software normally places them properly on the others, but make sure the markers are all properly placed). If a marker is not visible in some photos, the flag of this marker should be white or the marker should be blocked on those specific photos. You can do that by right-clicking on the marker on these photos and select Remove Projection or Block Marker. Repeat these step for each marker. Go to Workflow &gt; Align Photos and put the accuracy on High or Very high (the latter only for project without focus stacking). To save some time, you can check Generic preselection in the section Advanced. Select Apply masks to Key points and click OK. Note that if you have applied the masks to only some photos, select Apply masks to Tie points. Optional: Alignment optimization using gradual selection and camera positions. If the camera alignment is not satisfactory, it is possible to clean the tie points obtained and try to re-align the cameras. For instance, in the tie points generated by the alignment, you can delete outlier and imprecise points (Figure 6.12 and 6.13): In the top menu, click on Model and then Gradual Selection. Select Reconstruction uncertainty on Criterion and play with the Level value to remove the uncertain points. The higher the value, the worst is the point placed. Values between 30 and 10 generally give good results. Then OK. Press Delete (or fn + Backspace in Mac) on your keyboard to delete the selected points in red. You don’t need much more than 10,000 points for good photo alignments. After removing uncertain points, go to View and click on Reference to make the reference panel visible if it is not already. Click on the Optimize Cameras button (star icon) in the reference panel and in the Optimize Camera Alignment window, check all of the cameras in the General box and then click OK to optimize the camera posistions. In Model &gt; Gradual Selection, ensure that Reprojection error parameter is below 1. If it is not, check if the alignment runs well by clicking on the Show Cameras button (camera icon) on the top (the cameras needs to form a full circle around the flower). If the alignment fails, try to re-align photos by following step 3 (don’t forget to check the box Reset Current Alignment). If the alignment didn’t fail, go to Model &gt; Gradual Selection &gt; Reproduction error, and set the level to 1 and click OK. Then press Delete (or fn + Backspace in Mac). Manually remove remaining outlier points using the selection tools. Repeat these steps for each chunk. Figure 6.12: Use the selection tool to remove background points. Figure 6.13: Use the gradual selection tool to remove additional mis-calculated points. *Note: If the alignment fails using only one chunk and two or more camera groups, then it will be necessary to divide your job into several chunks. Each chunk should then contain photos from one flower position. Once the chunks are ready, you can proceed with the alignment following the previous steps. 6.8 Align chunks together Note: This step is only necessary if your project is divided into several chunks. At this step, it is important to align the different chunks with each other before they can be combined in a complete model. There are two ways to do this: using tie points (does not work every time) or using markers. To align using tie points: Select one of the chunks that you would like to align. Go to Workflow &gt; Align Chunks, select all the chunks you want to align together and set the method as Point based (Figure 6.14). Restrict the key points with masks. Click on OK. To align using markers: Place homologous markers on the flower, defined as remarkable points (e.g., distinguishable pattern such as color dots on the corolla), or little pen marks at the surface of the flower when homologous markers lack. These points need to be clearly identifiable on all chunks. You will need at least 5 markers, ideally located at different areas of the flower (e.g., near the pedicel, sepal tips, petals). Do not use points from the background to align chunks as they are independent from the flower (the flower changes position relative to the background). With the Navigation button selected (i.e., the cursor icon tool), right click on the point you want to add a marker on. Click on Place Marker &gt; New Marker. In the left panel, rename the marker accordingly. Make sure to use the same nomenclature on each chunk to be able to merge them according to their names. To help the software recognize the markers, spread them on photos throughout the chunk (it is normally sufficient to manually place them on 2-3 photos and the software normally places them properly on the others, but make sure the markers are all properly placed). If a marker is not visible in some photos, the flag of this marker should be white or the marker should be blocked on those specific photos. You can do that by right-clicking on the marker on these photos and select Remove Projection or Block Marker. Repeat these step for each marker and each chunk. Select one chunk. Go to Workflow &gt; Align Chunks, select the chunks you want to align, set the method as Marker based and then click OK. When the chunks are aligned, a [T] is put at the end of your chunk name to notify that it is transformed. You can check the alignment using the icon to show aligned chunks (i.e., the icon of layers on top of each others, Figure 6.15). The different chunks should be well aligned over the whole flower. If the alignment of your chunks is unsatisfactory, try to place more markers on recognizable features and spread across the whole flower. Additionally, you can manually align chunks using the tools to move the models in the space, but this is highly not recommended. Figure 6.14: Align chunks. Figure 6.15: Show aligned chunks to verify their positions. 6.9 Merge chunks Note: This step is only necessary if your project is divided into several chunks. The next step is to merge chunks together when they are well aligned. Click on Workflow &gt; Merge chunks, and merge using either the tie point method or the marker method depending on the option selected above. 6.10 Build 3D mesh Select the chunk or the merged chunks for which you want to build a 3D mesh (model). Go to Workflow &gt; Build Mesh. In the dialog box, make sure that Source Data is on Depth maps, Quality and Face Count on High (Figure 6.16). Note that although it is also possible to generate a mesh from a dense point cloud (which has to be built separately), the depth maps provide better results for objects with a high number of minor details. Then go to Advanced, check Calculate vertex colors and click OK. Once the mesh is produced, you should remove the pin and extra floating background parts using the selection tool. This will highlight the selection in red. Verify your selection and press Delete (or fn + Backspace) to remove them. Figure 6.16: Build 3D mesh. Our protocol merges the chunks to build a tie point model of all chunks before constructing a model for the merge chunk. We found that this is the best approach, although it is also possible to build models for each chunk separately and then merge these models to obtain a full model. 6.11 3D mesh touch ups You can smooth the mesh by clicking on Tools, Mesh, Smooth Mesh. You can also duplicate a 3D model to save one intact (right click on it and un-check Use as default to keep it as an archived model). If you smooth a mesh, you can’t undo it. You can fill holes in your mesh by clicking on Tools &gt; Mesh &gt; Close Holes. Note that if your holes are too big, the closing function can create unwanted structures. Similarly to smoothing, you cannot undo closing holes in the mesh. HOWEVER, this will remove the vertex colors in version 1.7.2, which we will need to place landmarks when doing the morphometrics. 6.12 Build texture To build the texture go to Workflow &gt; Build Texture, use the preset values and click OK. 6.13 Scaling To scale the model, go to the pictures of your merged chunk and follow these steps: On a picture displaying the scale bar, add new markers at each end of the scale bar and on a couple of additional photos. In the left panel, select both markers, right click on them and select Create Scale Bar. If the reference panel is not already visible on the left, go to View and click on Reference. Go to the reference panel, select the scale under Scale Bars and write 0.01 in the Distance (m) column (except if your scale bar has a different length, in which case, add the respective value of its length in meters). Click on the Update Transform button in the reference panel (icon of two rotating arrows). This is an important step, because otherwise the scale will not be incorporated to your model. To verify if the scale is taken into account, you can use the Ruler tool and select two points on your mesh to measure the distance between them. Figure 6.17: Scaling. Top arrow: Markers added at each end of the scale bar (i.e., at the 0 cm and 1 cm points). Middle Arrow: Update Transform button. Bottom arrow: Input of scale bar length in meters. Small red box (top): Ruler tool. Large red box (bottom): Reference panel. 6.14 Model orientation In Metashape, be sure that Show Info and Show Grid in Model &gt; Show/Hide Items are checked. You should see at the bottom right of the model panel the 3D axes. Make sure that the scale is correct because changing it will affect the coordinates of the 3D model and you will need to re-orient it. You can verify the scale using the Ruler tool. Use the Navigation tool to orient these 3D axes (x should be at 0° and y should be at 90°; Figure 6.18). Once you orient the 3D axes in the wanted direction, you can then use the tool Move Object to put the flower in the center of the grid (the cross in the center point of the grid should be hidden in the central point of the 3D model; Figure 6.18 and Figure 6.19). To orient the model, use the Rotate Object. The model should be facing the right side of the grid (the direction of the x axis; Figure 6.18 and Figure 6.19). Orient the binding box as well, using the Move Region, Resize Region and Rotate Region tools. The side with the cross on the box should be on the ventral side of the flower, and the side with the two dashes should be facing the opening of the flower. Note that depending on the software you use to open the model, the first view orientation may change when you open the final object file (Figure 6.20). Figure 6.18: Object (model) orientation tools. Left box: Navigation tool. Left box group: Object orientation tools. Arrow: Desired 3D axes orientation. Figure 6.19: Desired model orientation on the grid. Figure 6.20: Binding box orientation tools. Box group: Binding box orientation tools. Arrows: The cross and the two dashes on two different sides of the binding box. 6.15 Export model and texture You can export your 3D model by clicking on File &gt; Export &gt; Export Model. Name your model. Choose .ply as the extension. In the dialog box, tick the Vertex colors. This option will allow you to get color on the actual 3D model. Select Export texture as PNG. Make sure to export the texture with transparency, by ticking the Write alpha channel or Save alpha channel option (depending on the Agisoft Metashape version). The texture is a separate file with detailed color information that is wrapped on the model. Click on OK. "],["references.html", "References", " References "]]
